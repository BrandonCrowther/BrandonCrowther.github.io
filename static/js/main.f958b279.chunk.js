(this["webpackJsonpsnake-react"]=this["webpackJsonpsnake-react"]||[]).push([[0],[,,,,,,,,,,,,function(e,t){e.exports={BOARD_SIZE:10}},,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"Snake",(function(){return c})),n.d(t,"Tail",(function(){return h})),n.d(t,"Head",(function(){return u})),n.d(t,"Cheese",(function(){return l}));var a=n(11),i=n(10),s=n(2),r=n(4),o=n(12).BOARD_SIZE,c=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;Object(s.a)(this,e),this.x=t,this.y=n,this.next=a}return Object(r.a)(e,[{key:"deleteLast",value:function(){if(this.next)return this.next.next?this.next.deleteLast():(this.next=null,!0)}}]),e}(),h=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return n}(c),u=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"checkCollision",value:function(){for(var e=this.next;null!=e;){if(this.x==e.x&&this.y==e.y)return!0;e=e.next}return this.x==o||this.x<0||(this.y==o||this.y<0)}},{key:"getPositions",value:function(){for(var e=[[this.x,this.y]],t=this.next;null!=t;)e.push([t.x,t.y]),t=t.next;return e}},{key:"getLength",value:function(){return this.getPositions().length}}]),n}(c),l=function e(t,n){Object(s.a)(this,e),this.x=t,this.y=n}},,,,,,,function(e,t,n){e.exports=n(45)},,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){},,,,,,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},,function(e,t,n){"use strict";n.r(t);var a=n(1),i=n.n(a),s=n(20),r=n.n(s),o=(n(29),n(30),n(3)),c=n.n(o),h=n(6),u=n(2),l=n(4),d=n(11),f=n(10),p=n(22),m=(n(32),n(8)),y=n(5),v=n(17),x=(v.Snake,v.Tail,v.Head),b=(v.Cheese,n(12).BOARD_SIZE),k=n(8),w=function(){function e(t,n){Object(u.a)(this,e),this.model=t,this.tf=n}return Object(l.a)(e,[{key:"getMove",value:function(e,t,n){var a=this,i=(e.x,e.y,e.getLength(),(t.x-e.x)/b),s=(t.y-e.y)/b,r=s>=0?Math.abs(s):0,o=[s<=0?Math.abs(s):0,i>=0?Math.abs(i):0,r,i<=0?Math.abs(i):0,new x(e.x,e.y-1,e.next).checkCollision()?0:1,new x(e.x+1,e.y,e.next).checkCollision()?0:1,new x(e.x,e.y+1,e.next).checkCollision()?0:1,new x(e.x-1,e.y,e.next).checkCollision()?0:1],c=k.tidy((function(e){var t=k.tensor2d(o,[1,o.length]);return a.model.predict(t).flatten().arraySync()}));return this.formatMove(c)}},{key:"formatMove",value:function(e){var t=e.indexOf(Math.max.apply(Math,Object(y.a)(e)));return 0==t?[0,-1]:1==t?[1,0]:2==t?[0,1]:3==t?[-1,0]:void 0}}]),e}(),g=n(23),M=n(8),O=n(17),j=(O.Snake,O.Tail,O.Head),E=(O.Cheese,n(12).BOARD_SIZE),S=function(){function e(){Object(u.a)(this,e),this.newModel(),this.inputs=[],this.scores=[]}return Object(l.a)(e,[{key:"newModel",value:function(){var e=this;M.tidy((function(){e.model=M.sequential({layers:[M.layers.dense({units:4,activation:"softmax",inputShape:[8]})]}),e.model.compile({optimizer:"adam",loss:M.metrics.categoricalCrossentropy})}))}},{key:"getMove",value:function(e,t,n,a){var i=this,s=(e.x,e.y,e.getLength(),(t.x-e.x)/E),r=(t.y-e.y)/E,o=r>=0?Math.abs(r):0,c=r<=0?Math.abs(r):0,h=s>=0?Math.abs(s):0,u=s<=0?Math.abs(s):0,l=new j(e.x,e.y-1,e.next).checkCollision()?0:1,d=new j(e.x+1,e.y,e.next).checkCollision()?0:1,f=new j(e.x,e.y+1,e.next).checkCollision()?0:1,p=new j(e.x-1,e.y,e.next).checkCollision()?0:1,m=[c,h,o,u,l,d,f,p],y=M.tidy((function(e){var t=M.tensor2d(m,[1,m.length]);return i.model.predict(t).flatten().arraySync()}));this.inputs.push(m);var v=[0,0,0,0];return l>0&&(v[0]=.1+c/2/1.1),d>0&&(v[1]=.1+h/2/1.1),f>0&&(v[2]=.1+o/2/1.1),p>0&&(v[3]=.1+u/2/1.1),this.scores.push(v),this.formatMove(y)}},{key:"formatMove",value:function(e){var t=e.indexOf(Math.max.apply(Math,Object(y.a)(e)));return 0==t?[0,-1]:1==t?[1,0]:2==t?[0,1]:3==t?[-1,0]:void 0}},{key:"save",value:function(){var e=Object(h.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.model.save('downloads://" + '+t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fitReplay",value:function(){var e=Object(h.a)(c.a.mark((function e(){var t,n,a,i,s=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=M.tidy((function(e){return[M.tensor2d(s.inputs,[s.inputs.length,s.inputs[0].length]),M.tensor2d(s.scores,[s.scores.length,s.scores[0].length])]})),n=Object(g.a)(t,2),a=n[0],i=n[1],e.next=3,this.model.fit(a,i,{epochs:100});case 3:this.scores=[],this.inputs=[],i.dispose(),a.dispose();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),C=n(17),L=(C.Snake,C.Tail),N=C.Head,A=C.Cheese,B=n(12).BOARD_SIZE,I=function(){function e(t){Object(u.a)(this,e),this.input=t,this.board=Object(y.a)(Array(B)).map((function(e){return Array(B).fill(0)})),this.score=0,this.ticks=0,this.head=new N(Math.floor(B/4+Math.random()*(B/4)),Math.floor(B/4+Math.random()*(B/4))),this.head.next=new L(this.head.x-1,this.head.y),this.cheese=this.createNewCheese(),this.states=[],this.dist=this.distance(),this.redraw()}return Object(l.a)(e,[{key:"tick",value:function(){var e=this.input.getMove(this.head,this.cheese,this.score,this.board),t=new L(this.head.x,this.head.y);this.head.next?(t.next=this.head.next,this.head.next=t):this.head.next=t,this.head.x+=e[0],this.head.y+=e[1];var n=this.head.checkCollision();if(this.checkCheese()?(this.cheese=this.createNewCheese(),this.score+=10,this.ticks=0):this.head.deleteLast(),this.ticks++,this.ticks==B*B&&(n=!0),!n){this.redraw();var a=this.distance();this.dist>a?this.score+=1:this.score-=1,this.dist=a}return n}},{key:"checkCheese",value:function(){return this.head.x==this.cheese.x&&this.head.y==this.cheese.y}},{key:"createNewCheese",value:function(){for(var e=Math.floor(Math.random()*B),t=Math.floor(Math.random()*B),n=this.head.getPositions();n.find((function(n){return n[0]==e&&n[1]==t}));)e=Math.floor(Math.random()*B),t=Math.floor(Math.random()*B);return new A(e,t)}},{key:"redraw",value:function(){var e=this;this.board=Object(y.a)(Array(B)).map((function(e){return Array(B).fill(0)})),this.head.getPositions().forEach((function(t){e.board[t[1]][t[0]]=2})),this.board[this.head.y][this.head.x]=1,this.board[this.cheese.y][this.cheese.x]=3,this.states.push(this.board)}},{key:"distance",value:function(){return Math.sqrt(Math.abs(Math.pow(this.head.x-this.cheese.x,2)+Math.pow(this.head.y-this.cheese.y,2)))}}]),e}(),R=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).sleep=function(e){return new Promise((function(t){return setTimeout(t,e)}))},a.increaseSpeed=function(e){a.setState({speed:Math.max(a.state.speed-5,0)})},a.decreaseSpeed=function(e){a.setState({speed:a.state.speed+5})},a.toggleMode=function(e){a.setState({trainingMode:!a.state.trainingMode})},a.state={isLoaded:!1,board:[[]],speed:25,trainingMode:!1},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=Object(h.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.ready();case 2:return e.next=4,m.loadLayersModel("model/model.json");case 4:t=e.sent,n=new w(t),this.setState({isLoaded:!0,modelInterface:n},this.gameLoop);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gameLoop",value:function(){var e=Object(h.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.trainingMode){e.next=14;break}t=new I(this.state.modelInterface),n=!1;case 3:if(n){e.next=10;break}return n=t.tick(),this.setState({board:t.board}),e.next=8,this.sleep(this.state.speed);case 8:e.next=3;break;case 10:return e.next=12,this.sleep(1e3);case 12:e.next=0;break;case 14:this.train();case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"train",value:function(){var e=Object(h.a)(c.a.mark((function e(){var t,n,a,i,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=1,a=new S;case 3:if(!this.state.trainingMode){e.next=19;break}n++,i=new I(a),s=!1;case 7:if(s){e.next=14;break}return s=i.tick(),e.next=11,this.sleep(this.state.speed);case 11:this.setState({board:i.board,run:n}),e.next=7;break;case 14:return e.next=16,a.fitReplay();case 16:i.score>t&&(t=i.score,this.setState({topScore:t})),e.next=3;break;case 19:this.gameLoop();case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.trainingMode,n=e.isLoaded,a=e.board,s=(e.run,{0:"gray",1:"red",2:"black",3:"yellow"});return n?i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("button",{onClick:this.toggleMode},"Toggle Mode")," ",t?"Training Mode":"Pre-trained Mode"),i.a.createElement("div",null),i.a.createElement("div",null,i.a.createElement("button",{onClick:this.decreaseSpeed},"-"),"Game Speed",i.a.createElement("button",{onClick:this.increaseSpeed},"+")),i.a.createElement("div",{className:"board"},a.map((function(e){return e.map((function(e){return i.a.createElement("div",{className:"block "+s[e]})}))})))):i.a.createElement(p.a,{animation:"border",role:"status",style:{width:"4rem",height:"4rem"}},i.a.createElement("span",{className:"sr-only"},"Loading..."))}}]),n}(i.a.Component);n(44);var T=function(){return i.a.createElement("div",{className:"App"},i.a.createElement("h1",null,"Snake Neural Network"),i.a.createElement("p",null,i.a.createElement("span",null,"By Brandon Crowther"),i.a.createElement("strong",null,"\xa0\xa0|\xa0\xa0"),i.a.createElement("a",{href:"https://github.com/BrandonCrowther/SnakeNN"},"Github"),i.a.createElement("strong",null,"\xa0\xa0|\xa0\xa0"),i.a.createElement("a",{href:"mailto:bcrowthe11@gmail.com"},"bcrowthe11@gmail.com")),i.a.createElement("div",{className:"game"},i.a.createElement("div",null,i.a.createElement(R,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[24,1,2]]]);
//# sourceMappingURL=main.f958b279.chunk.js.map