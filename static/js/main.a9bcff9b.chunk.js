(this["webpackJsonpsnake-react"]=this["webpackJsonpsnake-react"]||[]).push([[0],{102:function(e,t){},103:function(e,t){},104:function(e,t,n){"use strict";n.r(t),function(e){var t=n(16),a=n(6),i=n(11),s=n(51),r=(s.Snake,s.Tail,s.Head),o=(s.Cheese,n(47).BOARD_SIZE),c=n(40),h=function(){function e(t,n){Object(a.a)(this,e),this.model=t,this.tf=n}return Object(i.a)(e,[{key:"getMove",value:function(e,t,n){var a=this,i=(e.x,e.y,e.getLength(),(t.x-e.x)/o),s=(t.y-e.y)/o,h=s>=0?Math.abs(s):0,u=[s<=0?Math.abs(s):0,i>=0?Math.abs(i):0,h,i<=0?Math.abs(i):0,new r(e.x,e.y-1,e.next).checkCollision()?0:1,new r(e.x+1,e.y,e.next).checkCollision()?0:1,new r(e.x,e.y+1,e.next).checkCollision()?0:1,new r(e.x-1,e.y,e.next).checkCollision()?0:1],l=c.tidy((function(e){var t=c.tensor2d(u,[1,u.length]);return a.model.predict(t).flatten().arraySync()}));return this.formatMove(l)}},{key:"formatMove",value:function(e){var n=e.indexOf(Math.max.apply(Math,Object(t.a)(e)));return 0==n?[0,-1]:1==n?[1,0]:2==n?[0,1]:3==n?[-1,0]:void 0}}]),e}();e.exports=h}.call(this,n(46)(e))},105:function(e,t,n){"use strict";n.r(t),function(e){var t=n(8),a=n(5),i=n.n(a),s=n(12),r=n(16),o=n(6),c=n(11),h=n(40),u=n(51),l=(u.Snake,u.Tail,u.Head),d=(u.Cheese,n(47).BOARD_SIZE),f=function(){function e(){Object(o.a)(this,e),this.newModel(),this.inputs=[],this.scores=[]}return Object(c.a)(e,[{key:"newModel",value:function(){var e=this;h.tidy((function(){e.model=h.sequential({layers:[h.layers.dense({units:4,activation:"softmax",inputShape:[8]})]}),e.model.compile({optimizer:"adam",loss:h.metrics.categoricalCrossentropy})}))}},{key:"getMove",value:function(e,t,n,a){var i=this,s=(e.x,e.y,e.getLength(),(t.x-e.x)/d),r=(t.y-e.y)/d,o=r>=0?Math.abs(r):0,c=r<=0?Math.abs(r):0,u=s>=0?Math.abs(s):0,f=s<=0?Math.abs(s):0,p=new l(e.x,e.y-1,e.next).checkCollision()?0:1,m=new l(e.x+1,e.y,e.next).checkCollision()?0:1,v=new l(e.x,e.y+1,e.next).checkCollision()?0:1,x=new l(e.x-1,e.y,e.next).checkCollision()?0:1,y=[c,u,o,f,p,m,v,x],b=h.tidy((function(e){var t=h.tensor2d(y,[1,y.length]);return i.model.predict(t).flatten().arraySync()}));this.inputs.push(y);var k=[0,0,0,0];return p>0&&(k[0]=.1+c/2/1.1),m>0&&(k[1]=.1+u/2/1.1),v>0&&(k[2]=.1+o/2/1.1),x>0&&(k[3]=.1+f/2/1.1),this.scores.push(k),this.formatMove(b)}},{key:"formatMove",value:function(e){var t=e.indexOf(Math.max.apply(Math,Object(r.a)(e)));return 0==t?[0,-1]:1==t?[1,0]:2==t?[0,1]:3==t?[-1,0]:void 0}},{key:"save",value:function(){var e=Object(s.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.model.save('downloads://" + '+t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fitReplay",value:function(){var e=Object(s.a)(i.a.mark((function e(){var n,a,s,r,o=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.tidy((function(e){return[h.tensor2d(o.inputs,[o.inputs.length,o.inputs[0].length]),h.tensor2d(o.scores,[o.scores.length,o.scores[0].length])]})),a=Object(t.a)(n,2),s=a[0],r=a[1],e.next=3,this.model.fit(s,r,{epochs:100});case 3:this.scores=[],this.inputs=[],r.dispose(),s.dispose();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();e.exports=f}.call(this,n(46)(e))},106:function(e,t,n){"use strict";n.r(t),function(e){var t=n(16),a=n(6),i=n(11),s=n(51),r=(s.Snake,s.Tail),o=s.Head,c=s.Cheese,h=n(47).BOARD_SIZE,u=function(){function e(n){Object(a.a)(this,e),this.input=n,this.board=Object(t.a)(Array(h)).map((function(e){return Array(h).fill(0)})),this.score=0,this.ticks=0,this.head=new o(Math.floor(h/4+Math.random()*(h/4)),Math.floor(h/4+Math.random()*(h/4))),this.head.next=new r(this.head.x-1,this.head.y),this.cheese=this.createNewCheese(),this.states=[],this.dist=this.distance(),this.redraw()}return Object(i.a)(e,[{key:"tick",value:function(){var e=this.input.getMove(this.head,this.cheese,this.score,this.board),t=new r(this.head.x,this.head.y);this.head.next?(t.next=this.head.next,this.head.next=t):this.head.next=t,this.head.x+=e[0],this.head.y+=e[1];var n=this.head.checkCollision();if(this.checkCheese()?(this.cheese=this.createNewCheese(),this.score+=10,this.ticks=0):this.head.deleteLast(),this.ticks++,this.ticks==h*h&&(n=!0),!n){this.redraw();var a=this.distance();this.dist>a?this.score+=1:this.score-=1,this.dist=a}return n}},{key:"checkCheese",value:function(){return this.head.x==this.cheese.x&&this.head.y==this.cheese.y}},{key:"createNewCheese",value:function(){for(var e=Math.floor(Math.random()*h),t=Math.floor(Math.random()*h),n=this.head.getPositions();n.find((function(n){return n[0]==e&&n[1]==t}));)e=Math.floor(Math.random()*h),t=Math.floor(Math.random()*h);return new c(e,t)}},{key:"redraw",value:function(){var e=this;this.board=Object(t.a)(Array(h)).map((function(e){return Array(h).fill(0)})),this.head.getPositions().forEach((function(t){e.board[t[1]][t[0]]=2})),this.board[this.head.y][this.head.x]=1,this.board[this.cheese.y][this.cheese.x]=3,this.states.push(this.board)}},{key:"distance",value:function(){return Math.sqrt(Math.abs(Math.pow(this.head.x-this.cheese.x,2)+Math.pow(this.head.y-this.cheese.y,2)))}}]),e}();e.exports=u}.call(this,n(46)(e))},108:function(e,t,n){"use strict";n.r(t);var a=n(21),i=n.n(a),s=n(55),r=n.n(s),o=(n(81),n(82),n(5)),c=n.n(o),h=n(12),u=n(6),l=n(11),d=n(13),f=n(14),p=n(75),m=(n(84),n(40)),v=n(104),x=n(105),y=n(106),b=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).sleep=function(e){return new Promise((function(t){return setTimeout(t,e)}))},a.increaseSpeed=function(e){a.setState({speed:Math.max(a.state.speed-5,0)})},a.decreaseSpeed=function(e){a.setState({speed:a.state.speed+5})},a.toggleMode=function(e){a.setState({trainingMode:!a.state.trainingMode})},a.state={isLoaded:!1,board:[[]],speed:25,trainingMode:!1},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=Object(h.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.ready();case 2:return e.next=4,m.loadLayersModel("model/model.json");case 4:t=e.sent,n=new v(t),this.setState({isLoaded:!0,modelInterface:n},this.gameLoop);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gameLoop",value:function(){var e=Object(h.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.trainingMode){e.next=14;break}t=new y(this.state.modelInterface),n=!1;case 3:if(n){e.next=10;break}return n=t.tick(),this.setState({board:t.board}),e.next=8,this.sleep(this.state.speed);case 8:e.next=3;break;case 10:return e.next=12,this.sleep(1e3);case 12:e.next=0;break;case 14:this.train();case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"train",value:function(){var e=Object(h.a)(c.a.mark((function e(){var t,n,a,i,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=1,a=new x;case 3:if(!this.state.trainingMode){e.next=19;break}n++,i=new y(a),s=!1;case 7:if(s){e.next=14;break}return s=i.tick(),e.next=11,this.sleep(this.state.speed);case 11:this.setState({board:i.board,run:n}),e.next=7;break;case 14:return e.next=16,a.fitReplay();case 16:i.score>t&&(t=i.score,this.setState({topScore:t})),e.next=3;break;case 19:this.gameLoop();case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.trainingMode,n=e.isLoaded,a=e.board,s=(e.run,{0:"gray",1:"red",2:"black",3:"yellow"});return n?i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("button",{onClick:this.toggleMode},"Toggle Mode")," ",t?"Training Mode":"Pre-trained Mode"),i.a.createElement("div",null),i.a.createElement("div",null,i.a.createElement("button",{onClick:this.decreaseSpeed},"-"),"Game Speed",i.a.createElement("button",{onClick:this.increaseSpeed},"+")),i.a.createElement("div",{className:"board"},a.map((function(e){return e.map((function(e){return i.a.createElement("div",{className:"block "+s[e]})}))})))):i.a.createElement(p.a,{animation:"border",role:"status",style:{width:"4rem",height:"4rem"}},i.a.createElement("span",{className:"sr-only"},"Loading..."))}}]),n}(i.a.Component);n(107);var k=function(){return i.a.createElement("div",{className:"App"},i.a.createElement("h1",null,"Snake Neural Network"),i.a.createElement("p",null,i.a.createElement("span",null,"By Brandon Crowther"),i.a.createElement("strong",null,"\xa0\xa0|\xa0\xa0"),i.a.createElement("a",{href:"https://github.com/BrandonCrowther/SnakeNN"},"Github"),i.a.createElement("strong",null,"\xa0\xa0|\xa0\xa0"),i.a.createElement("a",{href:"mailto:bcrowthe11@gmail.com"},"bcrowthe11@gmail.com")),i.a.createElement("div",{className:"game"},i.a.createElement("div",null,i.a.createElement(b,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(k,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},47:function(e,t){e.exports={BOARD_SIZE:10}},51:function(e,t,n){"use strict";n.r(t),function(e){var t=n(13),a=n(14),i=n(6),s=n(11),r=n(47).BOARD_SIZE,o=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;Object(i.a)(this,e),this.x=t,this.y=n,this.next=a}return Object(s.a)(e,[{key:"deleteLast",value:function(){if(this.next)return this.next.next?this.next.deleteLast():(this.next=null,!0)}}]),e}(),c=function(e){Object(t.a)(s,e);var n=Object(a.a)(s);function s(){return Object(i.a)(this,s),n.apply(this,arguments)}return s}(o),h=function(e){Object(t.a)(o,e);var n=Object(a.a)(o);function o(){return Object(i.a)(this,o),n.apply(this,arguments)}return Object(s.a)(o,[{key:"checkCollision",value:function(){for(var e=this.next;null!=e;){if(this.x==e.x&&this.y==e.y)return!0;e=e.next}return this.x==r||this.x<0||(this.y==r||this.y<0)}},{key:"getPositions",value:function(){for(var e=[[this.x,this.y]],t=this.next;null!=t;)e.push([t.x,t.y]),t=t.next;return e}},{key:"getLength",value:function(){return this.getPositions().length}}]),o}(o);e.exports={Snake:o,Tail:c,Head:h,Cheese:function e(t,n){Object(i.a)(this,e),this.x=t,this.y=n}}}.call(this,n(46)(e))},76:function(e,t,n){e.exports=n(108)},81:function(e,t,n){},82:function(e,t,n){},84:function(e,t,n){},87:function(e,t){},88:function(e,t){},96:function(e,t){}},[[76,1,2]]]);
//# sourceMappingURL=main.a9bcff9b.chunk.js.map